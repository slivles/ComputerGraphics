<!DOCTYPE html>

<html>

<head>
<style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js">
</script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>
<div>
Tank
</div>


</style>
</head>

<body> 
<script>
var renderer, camera, controls, scene, axes;
var stats;
var theta1 = 0.0;
var theta2 = 0.0;
var baseTheta = 0.0;
var keyboard = new KeyboardState();
var base;
var turret;
var turn;
var cannon;
var tank;
var tank01; 
init();
animate();
function randomPos(){
	var a = Math.random()*200 - 100;
  return a;
}
function buildTarget(){
	var mat = new THREE.MeshLambertMaterial({color: 0x99FFFF,side: THREE.DoubleSide});
  var ring = new THREE.RingGeometry(0.1,25,300);
  var target = new THREE.Mesh(ring,mat);
  target.position.x = randomPos();
  target.position.z = randomPos();
  target.position.y = 40;
  return target;
}
function buildParts() {
  var parts = [];
    
	var mat = new THREE.MeshLambertMaterial({color: 0xFF4500});
	base = new THREE.Object3D();
	var baseMesh = new THREE.Mesh (new THREE.BoxGeometry (40,10,20), mat);
	base.add (baseMesh);
	baseMesh.position.set (-10,5,0);
	parts.push (base);

    turret = new THREE.Mesh (new THREE.CylinderGeometry (10,10,10, 30),mat);
    parts.push (turret);
    
    turn = new THREE.Object3D();
    var turnMesh = new THREE.Mesh (new THREE.CylinderGeometry (1.5, 1.5, 10, 30), mat);
    turn.add (turnMesh);
    turnMesh.rotation.x = Math.PI/2;
    parts.push (turn);
    
    cannon = new THREE.Object3D();
    var cannon0 = new THREE.Object3D();
    var cannonMesh = new THREE.Mesh (new THREE.CylinderGeometry (1.5, 1.5, 10, 30), mat);
    cannon0.add (cannonMesh);
    cannonMesh.position.y = 5;
    cannon.add (cannon0);
    cannon0.rotation.z = -Math.PI/2;
    parts.push (cannon);
    
    return parts;
}

function buildTank(){

  let parts = buildParts();
  
  let tank = new THREE.Object3D();

  let base = parts[0];
  tank.add (base);
  
  let turret = parts[1];
  tank.add (turret);
  turret.position.set (0, 15, 0);
  console.log (theta1);
  turret.rotation.y = theta1;
  
  let turn = parts[2]
  turn.position.x = 10;
  turn.rotation.z = theta2;
  turret.add (turn);
  
  let cannon = parts[3]
  turn.add (cannon);
  
  return tank;
}

function init() {

  renderer = new THREE.WebGLRenderer({
    antialias: true
  });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);

  document.body.appendChild(renderer.domElement);


  camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.z = 50;  // important
  camera.position.x=100;
  camera.position.y=100;

  controls = new THREE.OrbitControls(camera, renderer.domElement);

  scene = new THREE.Scene();
  
  let gridXZ = new THREE.GridHelper(200, 10, 'red', 'white');
  scene.add(gridXZ);
	
  var target = buildTarget();
  scene.add(target);

  tank01 = buildTank();
  scene.add (tank01);
  light = new THREE.PointLight(0xffffff);
  light.position.set(100, 300, 200);
  scene.add(light);
}

function animate() {
  
  controls.update();
  keyboard.update();
  renderer.render (scene, camera);
  if(theta1 > 6.28 || theta1 <  -6.28 )theta1 = theta1 % 6.28;
  turn.rotation.z = theta2;
	if(keyboard.pressed('W')){
  	if(base.rotation.y <= theta1){
    	base.rotation.y += 0.025; 
    }
    else if(base.rotation.y > theta1){
    	base.rotation.y -= 0.025; 
    }
  	tank01.position.x += 0.5*Math.cos(theta1);
    tank01.position.z -= 0.5*Math.sin(theta1);
  }
	if(keyboard.pressed('A')){
  	theta1 +=0.05;
    turret.rotation.y = theta1;
  }
  if(keyboard.pressed('D')){
  	 theta1 -=0.05;
     turret.rotation.y = theta1; 
  }
  else if(keyboard.pressed('S')){
  	if(base.rotation.y <= theta1){
    	base.rotation.y += 0.025; 
    }
    else if(base.rotation.y > theta1){
    	base.rotation.y -= 0.025; 
    }
  	tank01.position.x -= 0.5*Math.cos(theta1);
    tank01.position.z += 0.5*Math.sin(theta1);
  }
  else if(keyboard.pressed('Q')){
  	if(theta2 <0.4){
    	theta2 += 0.025;
    }
  }
  else if(keyboard.pressed('E')){
  	if(theta2 > -0.2){
    	theta2 -= 0.025;
    }
  }
  requestAnimationFrame (animate);
  
}


</script>
</body>

</html>